# Solid Cache Configuration
# Database-backed caching with automatic expiration
#
# Benefits over Redis:
# - No additional infrastructure (uses existing PostgreSQL)
# - Supports much larger cache sizes (up to 10TB)
# - Encryption support via database-level encryption
# - Simpler deployment and maintenance

default: &default
  store_options:
    # Cap age of oldest cache entry to fulfill retention policies
    max_age: <%= 60.days.to_i %>
    max_size: <%= 256.megabytes %>
    namespace: <%= Rails.env %>
    # Expiry batch size for cleanup
    expiry_batch_size: 100
    # Seconds to sleep between expiry batch operations
    expiry_method: job
    # Use async expiry to avoid blocking writes
    expiry_queue: maintenance

development:
  <<: *default
  store_options:
    max_age: <%= 1.day.to_i %>
    max_size: <%= 64.megabytes %>
    namespace: <%= Rails.env %>

test:
  <<: *default
  store_options:
    max_age: <%= 1.hour.to_i %>
    max_size: <%= 16.megabytes %>
    namespace: <%= Rails.env %>

production:
  database: cache
  <<: *default
  store_options:
    # 60-day retention for production cache
    max_age: <%= 60.days.to_i %>
    # 1GB cache size for production
    max_size: <%= 1.gigabyte %>
    namespace: <%= Rails.env %>
    # Use job-based expiry for async cleanup
    expiry_method: job
    expiry_queue: maintenance
    expiry_batch_size: 500
