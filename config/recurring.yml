# Solid Queue Recurring Jobs Configuration
#
# Schedule format examples:
#   every second
#   every 2 seconds
#   every minute
#   every 5 minutes
#   every hour
#   every day at 3am
#   every Monday at 5pm
#   at 5am every day
#
# Job configuration:
#   class: The job class name (e.g., CleanupExpiredSessionsJob)
#   command: Raw Ruby command to execute (alternative to class)
#   queue: Queue name (defaults to job's configured queue)
#   args: Arguments to pass to the job
#   priority: Job priority (lower = higher priority)
#   schedule: When to run

# Development and test environments don't run recurring jobs automatically
development: {}

test: {}

production:
  # Send payment reminders for invoices due within 7 days
  # Runs daily at 9am to catch business hours
  payment_reminders_due_soon:
    class: PaymentReminderJob
    queue: mailers
    args:
      - due_soon
    schedule: every day at 9am

  # Send payment reminders for overdue invoices
  # Runs daily at 10am, after due_soon reminders
  payment_reminders_overdue:
    class: PaymentReminderJob
    queue: mailers
    args:
      - overdue
    schedule: every day at 10am

  # Clean up expired user sessions daily at 3am
  # Removes sessions older than 30 days and inactive sessions (no activity for 7 days)
  cleanup_expired_sessions:
    class: CleanupExpiredSessionsJob
    queue: maintenance
    args:
      expiry_days: 30
      inactive_days: 7
    schedule: every day at 3am

  # Clear finished Solid Queue jobs hourly
  clear_solid_queue_finished_jobs:
    command: "SolidQueue::Job.clear_finished_in_batches(sleep_between_batches: 0.3)"
    schedule: every hour at minute 12

  # Clean up old audit logs monthly (keep 1 year)
  cleanup_old_audits:
    command: "Audited::Audit.where('created_at < ?', 1.year.ago).in_batches(of: 1000).delete_all"
    queue: maintenance
    schedule: at 2am on the 1st of every month
