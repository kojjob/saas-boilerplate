<% content_for :page_title, "All Accounts" %>

<div class="space-y-6">
  <%# Header %>
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-slate-900">All Accounts</h1>
      <p class="text-sm text-slate-500 mt-1">Manage all customer accounts on the platform</p>
    </div>
  </div>

  <%# Filters %>
  <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4">
    <%= form_with url: owner_accounts_path, method: :get, class: "flex flex-wrap items-end gap-4" do |f| %>
      <div class="flex-1 min-w-[200px]">
        <label class="block text-xs font-medium text-slate-500 uppercase tracking-wider mb-2">Search</label>
        <%= text_field_tag :search, params[:search], placeholder: "Search by name or slug...", class: "w-full px-4 py-2.5 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500" %>
      </div>

      <div class="w-40">
        <label class="block text-xs font-medium text-slate-500 uppercase tracking-wider mb-2">Status</label>
        <%= select_tag :status, options_for_select([["All Statuses", ""]] + @statuses.map { |s| [s.titleize, s] }, params[:status]), class: "w-full px-4 py-2.5 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500" %>
      </div>

      <div class="w-40">
        <label class="block text-xs font-medium text-slate-500 uppercase tracking-wider mb-2">Plan</label>
        <%= select_tag :plan_id, options_for_select([["All Plans", ""]] + @plans.map { |p| [p.name, p.id] }, params[:plan_id]), class: "w-full px-4 py-2.5 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500" %>
      </div>

      <div class="flex gap-2">
        <%= submit_tag "Filter", class: "px-4 py-2.5 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors cursor-pointer" %>
        <%= link_to "Clear", owner_accounts_path, class: "px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-medium rounded-lg transition-colors" %>
      </div>
    <% end %>
  </div>

  <%# Accounts Table %>
  <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
    <table class="min-w-full divide-y divide-slate-200">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Account</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Plan</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Users</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Created</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-slate-200">
        <% @accounts.each do |account| %>
          <tr class="hover:bg-slate-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-semibold text-sm">
                  <%= account.name.first.upcase %>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-slate-900"><%= account.name %></div>
                  <div class="text-xs text-slate-500"><%= account.slug %></div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= account.plan&.name == 'Enterprise' ? 'bg-amber-100 text-amber-800' : account.plan&.name == 'Pro' ? 'bg-blue-100 text-blue-800' : 'bg-slate-100 text-slate-800' %>">
                <%= account.plan&.name || "No Plan" %>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% status_class = case account.subscription_status
                 when "active" then "bg-green-100 text-green-800"
                 when "trialing" then "bg-blue-100 text-blue-800"
                 when "past_due" then "bg-red-100 text-red-800"
                 when "canceled" then "bg-slate-100 text-slate-800"
                 else "bg-slate-100 text-slate-800"
                 end %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= status_class %>">
                <%= account.subscription_status&.titleize || "Unknown" %>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
              <%= account.users.count %> user<%= account.users.count == 1 ? "" : "s" %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
              <%= account.created_at.strftime("%b %d, %Y") %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
              <%= link_to owner_account_path(account), class: "text-purple-600 hover:text-purple-900 font-medium" do %>
                View
              <% end %>
            </td>
          </tr>
        <% end %>

        <% if @accounts.empty? %>
          <tr>
            <td colspan="6" class="px-6 py-12 text-center">
              <div class="flex flex-col items-center">
                <svg class="w-12 h-12 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                <p class="mt-2 text-sm text-slate-500">No accounts found</p>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%# Pagination %>
  <% if @pagy.pages > 1 %>
    <div class="flex justify-center">
      <%== pagy_nav(@pagy) %>
    </div>
  <% end %>
</div>
