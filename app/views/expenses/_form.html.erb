<%= form_with model: expense, class: "space-y-5" do |f| %>
  <% if expense.errors.any? %>
    <div class="rounded-lg bg-red-50 p-4 text-sm text-red-700">
      <ul class="list-disc pl-5 space-y-1">
        <% expense.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# Expense Details Section %>
  <div class="space-y-4">
    <h3 class="text-sm font-medium text-gray-900">Expense details</h3>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Description <span class="text-red-500">*</span></label>
      <%= f.text_field :description,
          class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",
          placeholder: "What was this expense for?" %>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Amount <span class="text-red-500">*</span></label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-400 text-sm"><%= expense.currency_symbol %></span>
          </div>
          <%= f.number_field :amount,
              step: 0.01,
              min: 0,
              class: "w-full pl-8 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",
              placeholder: "0.00" %>
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
        <%= f.select :currency,
            @currencies,
            {},
            class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white" %>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Date <span class="text-red-500">*</span></label>
        <%= f.date_field :expense_date,
            class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" %>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Category <span class="text-red-500">*</span></label>
        <%= f.select :category,
            @categories,
            { prompt: "Select a category" },
            class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white" %>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Vendor <span class="text-gray-400 font-normal">(optional)</span></label>
      <%= f.text_field :vendor,
          class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",
          placeholder: "Store or vendor name" %>
    </div>
  </div>

  <%# Project & Client Section %>
  <div class="space-y-4 pt-4 border-t border-gray-100">
    <h3 class="text-sm font-medium text-gray-900">Associate with</h3>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Project <span class="text-gray-400 font-normal">(optional)</span></label>
        <%= f.collection_select :project_id, @projects, :id, :name,
            { include_blank: "No project" },
            class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white" %>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Client <span class="text-gray-400 font-normal">(optional)</span></label>
        <%= f.collection_select :client_id, @clients, :id, :name,
            { include_blank: "No client" },
            class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white" %>
      </div>
    </div>
  </div>

  <%# Billing & Receipt Section %>
  <div class="space-y-4 pt-4 border-t border-gray-100">
    <h3 class="text-sm font-medium text-gray-900">Billing & Receipt</h3>

    <div class="flex items-center gap-6">
      <div class="flex items-center gap-3">
        <%= f.check_box :billable,
            class: "h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded" %>
        <label class="text-sm text-gray-700">Billable to client</label>
      </div>
      <div class="flex items-center gap-3">
        <%= f.check_box :reimbursable,
            class: "h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded" %>
        <label class="text-sm text-gray-700">Reimbursable</label>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Receipt <span class="text-gray-400 font-normal">(optional)</span></label>
      <% if expense.receipt.attached? %>
        <div class="mb-3 p-3 bg-gray-50 rounded-lg flex items-center justify-between">
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <span class="text-sm text-gray-600"><%= expense.receipt.filename %></span>
          </div>
          <%= link_to rails_blob_path(expense.receipt, disposition: "attachment"), class: "text-sm text-emerald-600 hover:text-emerald-700" do %>
            Download
          <% end %>
        </div>
      <% end %>
      <%= f.file_field :receipt,
          accept: "image/*,.pdf",
          class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100 cursor-pointer" %>
      <p class="mt-1 text-xs text-gray-500">Upload an image or PDF of your receipt (max 10MB)</p>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Notes <span class="text-gray-400 font-normal">(optional)</span></label>
      <%= f.text_area :notes,
          rows: 3,
          class: "w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none",
          placeholder: "Any additional details about this expense..." %>
    </div>
  </div>

  <%# Footer with actions %>
  <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
    <%= link_to "Cancel", expenses_path,
        class: "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" %>
    <%= f.submit expense.persisted? ? "Save changes" : "Add expense",
        class: "px-4 py-2 text-sm font-medium text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-colors cursor-pointer" %>
  </div>
<% end %>
