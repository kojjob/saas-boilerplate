<% content_for(:title) { "#{@account.name} - Admin" } %>

<div class="mb-6">
  <%= link_to "← Back to Accounts", admin_accounts_path, class: "text-indigo-600 hover:text-indigo-500" %>
</div>

<div class="bg-white rounded-lg shadow overflow-hidden">
  <div class="px-6 py-5 border-b border-slate-200 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-slate-900"><%= @account.name %></h1>
      <p class="text-slate-500"><%= @account.plan&.name || "No Plan" %> · <%= render_subscription_badge(@account.subscription_status) %></p>
    </div>
    <div class="flex space-x-3">
      <%= link_to "Edit", edit_admin_account_path(@account), class: "inline-flex items-center px-4 py-2 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 bg-white hover:bg-slate-50" %>
      <%= button_to "Delete", admin_account_path(@account), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this account? This action cannot be undone." }, class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700" %>
    </div>
  </div>

  <div class="px-6 py-5">
    <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
      <div>
        <dt class="text-sm font-medium text-slate-500">Name</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @account.name %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Plan</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @account.plan&.name || "No Plan" %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Subscription Status</dt>
        <dd class="mt-1"><%= render_subscription_badge(@account.subscription_status) %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Trial Ends At</dt>
        <dd class="mt-1 text-sm text-slate-900">
          <% if @account.trial_ends_at %>
            <%= @account.trial_ends_at.strftime("%B %d, %Y") %>
            <% if @account.trial_ends_at > Time.current %>
              <span class="text-slate-500">(<%= distance_of_time_in_words_to_now(@account.trial_ends_at) %> remaining)</span>
            <% else %>
              <span class="text-red-500">(expired)</span>
            <% end %>
          <% else %>
            Not set
          <% end %>
        </dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Created</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @account.created_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Members</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @account.memberships.count %></dd>
      </div>
    </dl>
  </div>
</div>

<%# Quick Actions %>
<div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
  <%# Upgrade Plan %>
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-slate-200">
      <h2 class="text-lg font-semibold text-slate-900">Upgrade Plan</h2>
    </div>
    <div class="p-6">
      <%= form_with url: upgrade_admin_account_path(@account), method: :post, local: true do |f| %>
        <div class="mb-4">
          <%= f.select :plan_id, Plan.all.map { |p| [p.name, p.id] }, { include_blank: "Select Plan" }, class: "block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" %>
        </div>
        <%= f.submit "Upgrade", class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 cursor-pointer" %>
      <% end %>
    </div>
  </div>

  <%# Extend Trial %>
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-slate-200">
      <h2 class="text-lg font-semibold text-slate-900">Extend Trial</h2>
    </div>
    <div class="p-6">
      <%= form_with url: extend_trial_admin_account_path(@account), method: :post, local: true do |f| %>
        <div class="mb-4">
          <%= f.number_field :days, value: 14, min: 1, max: 365, class: "block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm", placeholder: "Days to extend" %>
        </div>
        <%= f.submit "Extend Trial", class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 cursor-pointer" %>
      <% end %>
    </div>
  </div>
</div>

<%# Members %>
<div class="mt-6 bg-white rounded-lg shadow overflow-hidden">
  <div class="px-6 py-4 border-b border-slate-200">
    <h2 class="text-lg font-semibold text-slate-900">Members</h2>
  </div>
  <% if @account.memberships.any? %>
    <table class="min-w-full divide-y divide-slate-200">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">User</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Role</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Joined</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-slate-200">
        <% @account.memberships.includes(:user).each do |membership| %>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center">
                  <span class="text-indigo-600 text-sm font-medium"><%= membership.user.initials %></span>
                </div>
                <div class="ml-3">
                  <%= link_to membership.user.full_name, admin_user_path(membership.user), class: "text-indigo-600 hover:text-indigo-500" %>
                  <div class="text-sm text-slate-500"><%= membership.user.email %></div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="capitalize"><%= membership.role %></span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
              <%= membership.created_at.strftime("%b %d, %Y") %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="px-6 py-4 text-slate-500">No members.</p>
  <% end %>
</div>
