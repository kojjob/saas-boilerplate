<% content_for :page_title, "Team Members" %>

<div class="space-y-6">
  <%# Hero Header with Dark Background %>
  <div class="relative overflow-hidden bg-linear-to-r from-slate-900 via-slate-800 to-slate-900 rounded-2xl shadow-2xl">
    <%# Decorative grid pattern %>
    <div class="absolute inset-0 opacity-10">
      <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
        <defs>
          <pattern id="members-grid" width="10" height="10" patternUnits="userSpaceOnUse">
            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#members-grid)"/>
      </svg>
    </div>

    <%# Gradient orbs %>
    <div class="absolute top-0 right-0 w-72 h-72 bg-amber-500/20 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 bg-orange-500/20 rounded-full blur-3xl"></div>

    <div class="relative px-6 py-8 sm:px-8 sm:py-10">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6">
        <%# Title and stats %>
        <div class="flex items-start gap-4">
          <div class="shrink-0 w-14 h-14 rounded-2xl bg-linear-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-500/30">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-white">Team Members</h1>
            <p class="mt-1 text-slate-400">Manage your team and invitations</p>
            <div class="mt-3 flex items-center gap-4">
              <div class="flex items-center gap-2">
                <span class="text-2xl font-bold text-white"><%= @memberships.active.count %></span>
                <span class="text-sm text-slate-400">Active</span>
              </div>
              <% pending_count = @memberships.pending.count %>
              <% if pending_count > 0 %>
                <div class="w-px h-6 bg-slate-700"></div>
                <div class="flex items-center gap-2">
                  <span class="text-2xl font-bold text-amber-400"><%= pending_count %></span>
                  <span class="text-sm text-slate-400">Pending</span>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <%# Action button %>
        <% if @current_membership&.can_manage_members? %>
          <div class="shrink-0">
            <%= link_to new_account_invitation_path, data: { turbo_frame: "modal" }, class: "inline-flex items-center gap-2 px-5 py-3 bg-linear-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-semibold rounded-xl shadow-lg shadow-amber-500/30 hover:shadow-amber-500/50 transition-all duration-300 hover:scale-105" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
              </svg>
              Invite Member
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <%# Active Members Section %>
  <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
    <div class="px-6 py-4 border-b border-slate-200 bg-linear-to-r from-slate-50 to-slate-100">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-linear-to-br from-green-500 to-emerald-600 flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <h2 class="text-lg font-semibold text-slate-900">Active Members</h2>
        <span class="ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full">
          <%= @memberships.active.count %>
        </span>
      </div>
    </div>

    <% if @memberships.active.any? %>
      <div class="divide-y divide-slate-100">
        <% @memberships.active.each do |membership| %>
          <div class="group px-6 py-4 hover:bg-linear-to-r hover:from-amber-50/50 hover:to-orange-50/50 transition-all duration-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="relative shrink-0">
                  <div class="w-12 h-12 rounded-xl bg-linear-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-500/20 group-hover:scale-110 transition-transform duration-300">
                    <span class="text-sm font-bold text-white">
                      <%= membership.user.first_name[0].upcase %><%= membership.user.last_name[0].upcase %>
                    </span>
                  </div>
                  <%# Online indicator %>
                  <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"></div>
                </div>
                <div>
                  <div class="flex items-center gap-2">
                    <p class="font-semibold text-slate-900 group-hover:text-amber-600 transition-colors"><%= membership.user.full_name %></p>
                    <% if membership.owner? %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd"/>
                        </svg>
                        Owner
                      </span>
                    <% end %>
                    <% if membership.user == Current.user %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        You
                      </span>
                    <% end %>
                  </div>
                  <p class="text-sm text-slate-500"><%= membership.user.email %></p>
                </div>
              </div>

              <div class="flex items-center gap-3">
                <span class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium <%= role_badge_class(membership.role) %>">
                  <%= membership.role.humanize %>
                </span>

                <% if @current_membership&.can_manage_members? && !membership.owner? && membership.user != Current.user %>
                  <div class="flex items-center gap-2">
                    <%= form_with url: account_member_path(membership), method: :patch, class: "inline-flex items-center gap-2" do |f| %>
                      <%= f.select :role, available_roles_for_select(@current_membership), { selected: membership.role }, class: "text-sm border-slate-200 rounded-lg focus:ring-amber-500 focus:border-amber-500 bg-slate-50" %>
                      <%= f.submit "Update", class: "px-3 py-1.5 text-sm font-medium text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors cursor-pointer" %>
                    <% end %>
                    <%= button_to account_member_path(membership), method: :delete, class: "px-3 py-1.5 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors", data: { turbo_confirm: "Are you sure you want to remove #{membership.user.full_name} from the team?" } do %>
                      Remove
                    <% end %>
                  </div>
                <% elsif membership.user == Current.user && !membership.owner? %>
                  <%= button_to leave_account_member_path(membership), method: :delete, class: "px-3 py-1.5 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors", data: { turbo_confirm: "Are you sure you want to leave this team?" } do %>
                    Leave Team
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="px-6 py-12 text-center">
        <div class="mx-auto w-16 h-16 rounded-2xl bg-linear-to-br from-slate-100 to-slate-200 flex items-center justify-center mb-4">
          <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
          </svg>
        </div>
        <p class="text-slate-500">No active members yet</p>
      </div>
    <% end %>
  </div>

  <%# Pending Invitations Section %>
  <% pending_invitations = @memberships.pending %>
  <% if pending_invitations.any? %>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
      <div class="px-6 py-4 border-b border-slate-200 bg-linear-to-r from-amber-50 to-orange-50">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-lg bg-linear-to-br from-amber-500 to-orange-600 flex items-center justify-center">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
          </div>
          <h2 class="text-lg font-semibold text-slate-900">Pending Invitations</h2>
          <span class="ml-2 px-2 py-0.5 bg-amber-100 text-amber-700 text-xs font-medium rounded-full">
            <%= pending_invitations.count %>
          </span>
        </div>
      </div>

      <div class="divide-y divide-slate-100">
        <% pending_invitations.each do |invitation| %>
          <div class="group px-6 py-4 hover:bg-linear-to-r hover:from-amber-50/30 hover:to-orange-50/30 transition-all duration-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="shrink-0">
                  <div class="w-12 h-12 rounded-xl bg-linear-to-br from-slate-200 to-slate-300 flex items-center justify-center">
                    <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                  </div>
                </div>
                <div>
                  <p class="font-semibold text-slate-900"><%= invitation.invitation_email %></p>
                  <p class="text-sm text-slate-500">
                    Invited by <%= invitation.invited_by&.full_name || 'Unknown' %>
                    <% if invitation.invited_at %>
                      <span class="mx-1">&middot;</span>
                      <span class="text-slate-400"><%= time_ago_in_words(invitation.invited_at) %> ago</span>
                    <% end %>
                  </p>
                </div>
              </div>

              <div class="flex items-center gap-3">
                <span class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium bg-amber-100 text-amber-800">
                  <svg class="w-3 h-3 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Pending
                </span>
                <span class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium <%= role_badge_class(invitation.role) %>">
                  <%= invitation.role.humanize %>
                </span>

                <% if @current_membership&.can_manage_members? %>
                  <div class="flex items-center gap-2">
                    <%= button_to resend_account_invitation_path(invitation), method: :post, class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors" do %>
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                      </svg>
                      Resend
                    <% end %>
                    <%= button_to account_invitation_path(invitation), method: :delete, class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors", data: { turbo_confirm: "Are you sure you want to cancel this invitation?" } do %>
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                      Cancel
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Tips Section %>
  <div class="bg-linear-to-r from-slate-50 to-slate-100 rounded-2xl border border-slate-200 p-6">
    <div class="flex items-start gap-4">
      <div class="shrink-0 w-10 h-10 rounded-xl bg-linear-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-500/20">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div>
        <h3 class="font-semibold text-slate-900">Team Roles</h3>
        <p class="mt-1 text-sm text-slate-600">
          <span class="font-medium text-amber-600">Owners</span> have full access to all features and settings.
          <span class="font-medium text-blue-600">Admins</span> can manage team members and most settings.
          <span class="font-medium text-slate-600">Members</span> can access projects, invoices, and client data.
        </p>
      </div>
    </div>
  </div>
</div>
