<% content_for :title, @post.meta_title.presence || @post.title %>
<% content_for :meta_description, @post.meta_description.presence || @post.excerpt.presence || truncate(strip_tags(@post.content), length: 160) %>
<% content_for :og_type, "article" %>
<% content_for :og_image, @post.featured_image_url if @post.featured_image_url.present? %>
<% content_for :canonical_url, post_url(@post) %>
<% content_for :meta_keywords, @post.blog_tags.pluck(:name).join(", ") if @post.blog_tags.any? %>

<% content_for :head do %>
  <%= blog_post_structured_data(@post) %>
  <%= breadcrumb_structured_data([
    { name: "Home", url: root_url },
    { name: "Blog", url: posts_url },
    @post.blog_category ? { name: @post.blog_category.name, url: category_url(@post.blog_category) } : nil,
    { name: @post.title, url: post_url(@post) }
  ].compact) %>
<% end %>

<div class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950">
  <!-- Hero Section -->
  <section class="relative pt-12 pb-16 overflow-hidden">
    <!-- Background Effects -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-amber-500/10 rounded-full blur-3xl"></div>
      <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl"></div>
    </div>

    <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2 text-sm text-slate-400 mb-8">
        <%= link_to "Blog", posts_path, class: "hover:text-amber-400 transition-colors" %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <% if @post.blog_category %>
          <%= link_to @post.blog_category.name, category_path(@post.blog_category), class: "hover:text-amber-400 transition-colors" %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        <% end %>
        <span class="text-slate-500 truncate max-w-xs"><%= @post.title %></span>
      </nav>

      <!-- Category Badge -->
      <% if @post.blog_category %>
        <%= link_to category_path(@post.blog_category), class: "inline-block px-4 py-1.5 bg-amber-500/20 text-amber-400 text-sm font-medium rounded-full mb-6 hover:bg-amber-500/30 transition-colors" do %>
          <%= @post.blog_category.name %>
        <% end %>
      <% end %>

      <!-- Title -->
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight">
        <%= @post.title %>
      </h1>

      <!-- Meta Information -->
      <div class="flex flex-wrap items-center gap-6 text-sm text-slate-400 mb-8">
        <% if @post.author %>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center text-white font-medium">
              <%= @post.author.email[0].upcase %>
            </div>
            <div>
              <div class="text-white font-medium"><%= @post.author.email.split('@').first.titleize %></div>
              <div class="text-xs text-slate-500">Author</div>
            </div>
          </div>
        <% end %>

        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span><%= @post.published_at&.strftime("%B %d, %Y") %></span>
        </div>

        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span><%= @post.reading_time %> min read</span>
        </div>

        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <span><%= number_with_delimiter(@post.views_count) %> views</span>
        </div>
      </div>

      <!-- Tags -->
      <% if @post.blog_tags.any? %>
        <div class="flex flex-wrap gap-2 mb-8">
          <% @post.blog_tags.each do |tag| %>
            <%= link_to tag_path(tag), class: "inline-block px-3 py-1 bg-white/5 border border-white/10 rounded-lg text-sm text-slate-400 hover:text-white hover:border-amber-500/50 hover:bg-amber-500/10 transition-all" do %>
              #<%= tag.name %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </section>

  <!-- Featured Image -->
  <% if @post.featured_image_url.present? %>
    <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
      <div class="rounded-3xl overflow-hidden shadow-2xl shadow-black/50">
        <img src="<%= @post.featured_image_url %>" alt="<%= @post.title %>" class="w-full h-auto object-cover">
      </div>
    </section>
  <% end %>

  <!-- Content Section -->
  <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
      <!-- Main Content -->
      <article class="lg:col-span-8">
        <!-- Article Content -->
        <div class="prose prose-lg prose-invert prose-amber max-w-none
          prose-headings:text-white prose-headings:font-bold
          prose-p:text-slate-300 prose-p:leading-relaxed
          prose-a:text-amber-400 prose-a:no-underline hover:prose-a:underline
          prose-strong:text-white
          prose-code:text-amber-400 prose-code:bg-white/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded
          prose-pre:bg-slate-800/50 prose-pre:border prose-pre:border-white/10 prose-pre:rounded-xl
          prose-blockquote:border-l-amber-500 prose-blockquote:bg-white/5 prose-blockquote:py-2 prose-blockquote:px-6 prose-blockquote:rounded-r-xl
          prose-ul:text-slate-300 prose-ol:text-slate-300
          prose-li:marker:text-amber-500
          prose-img:rounded-xl prose-img:shadow-lg
          prose-hr:border-white/10">
          <%= raw @post.content %>
        </div>

        <!-- Author Box -->
        <% if @post.author %>
          <div class="mt-12 p-6 rounded-2xl bg-white/5 backdrop-blur-md border border-white/10">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center text-white text-2xl font-bold flex-shrink-0">
                <%= @post.author.email[0].upcase %>
              </div>
              <div>
                <h3 class="text-lg font-bold text-white mb-1">
                  Written by <%= @post.author.email.split('@').first.titleize %>
                </h3>
                <p class="text-slate-400 text-sm mb-3">
                  Contributing author at our blog. Sharing insights and expertise to help you succeed.
                </p>
                <div class="flex items-center gap-4">
                  <span class="text-xs text-slate-500">
                    <%= @post.author.blog_posts.published.count %> articles published
                  </span>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Share Section -->
        <div class="mt-8 p-6 rounded-2xl bg-white/5 backdrop-blur-md border border-white/10">
          <h3 class="text-lg font-bold text-white mb-4">Share this article</h3>
          <div class="flex flex-wrap gap-3">
            <!-- Twitter/X -->
            <a href="https://twitter.com/intent/tweet?url=<%= url_for(request.original_url) %>&text=<%= CGI.escape(@post.title) %>"
               target="_blank"
               rel="noopener noreferrer"
               class="flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-slate-400 hover:text-white hover:border-amber-500/50 transition-all">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
              <span class="text-sm">Tweet</span>
            </a>

            <!-- LinkedIn -->
            <a href="https://www.linkedin.com/sharing/share-offsite/?url=<%= url_for(request.original_url) %>"
               target="_blank"
               rel="noopener noreferrer"
               class="flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-slate-400 hover:text-white hover:border-amber-500/50 transition-all">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"/>
              </svg>
              <span class="text-sm">Share</span>
            </a>

            <!-- Copy Link -->
            <button onclick="navigator.clipboard.writeText('<%= request.original_url %>'); this.querySelector('span').textContent = 'Copied!';"
                    class="flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-slate-400 hover:text-white hover:border-amber-500/50 transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
              </svg>
              <span class="text-sm">Copy Link</span>
            </button>
          </div>
        </div>

        <!-- Navigation -->
        <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <% if @previous_post %>
            <%= link_to post_path(@previous_post), class: "group p-4 rounded-xl bg-white/5 border border-white/10 hover:border-amber-500/30 transition-all" do %>
              <div class="flex items-center gap-2 text-sm text-slate-500 mb-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Previous Article
              </div>
              <div class="text-white font-medium group-hover:text-amber-400 transition-colors line-clamp-2">
                <%= @previous_post.title %>
              </div>
            <% end %>
          <% else %>
            <div></div>
          <% end %>

          <% if @next_post %>
            <%= link_to post_path(@next_post), class: "group p-4 rounded-xl bg-white/5 border border-white/10 hover:border-amber-500/30 transition-all text-right" do %>
              <div class="flex items-center justify-end gap-2 text-sm text-slate-500 mb-2">
                Next Article
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
              <div class="text-white font-medium group-hover:text-amber-400 transition-colors line-clamp-2">
                <%= @next_post.title %>
              </div>
            <% end %>
          <% end %>
        </div>
      </article>

      <!-- Sidebar -->
      <aside class="lg:col-span-4">
        <div class="sticky top-8 space-y-6">
          <!-- Table of Contents (placeholder - would need JS for real TOC) -->
          <div class="rounded-2xl bg-white/5 backdrop-blur-md border border-white/10 p-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
              </svg>
              Quick Navigation
            </h3>
            <div class="space-y-2">
              <%= link_to posts_path, class: "flex items-center gap-2 py-2 px-3 rounded-lg hover:bg-white/5 text-slate-400 hover:text-amber-400 transition-all" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Back to Blog
              <% end %>
              <% if @post.blog_category %>
                <%= link_to category_path(@post.blog_category), class: "flex items-center gap-2 py-2 px-3 rounded-lg hover:bg-white/5 text-slate-400 hover:text-amber-400 transition-all" do %>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                  </svg>
                  More in <%= @post.blog_category.name %>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- Related Posts -->
          <% if @related_posts&.any? %>
            <div class="rounded-2xl bg-white/5 backdrop-blur-md border border-white/10 p-6">
              <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
                Related Articles
              </h3>
              <div class="space-y-4">
                <% @related_posts.each do |related| %>
                  <%= link_to post_path(related), class: "group block" do %>
                    <div class="flex gap-3">
                      <% if related.featured_image_url.present? %>
                        <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                          <img src="<%= related.featured_image_url %>" alt="<%= related.title %>" class="w-full h-full object-cover">
                        </div>
                      <% else %>
                        <div class="w-16 h-16 rounded-lg bg-gradient-to-br from-amber-500/20 to-indigo-500/20 flex items-center justify-center flex-shrink-0">
                          <svg class="w-6 h-6 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
                          </svg>
                        </div>
                      <% end %>
                      <div class="min-w-0">
                        <h4 class="text-sm font-medium text-white group-hover:text-amber-400 transition-colors line-clamp-2">
                          <%= related.title %>
                        </h4>
                        <p class="text-xs text-slate-500 mt-1">
                          <%= related.reading_time %> min read
                        </p>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- Newsletter CTA -->
          <div class="rounded-2xl bg-gradient-to-br from-amber-500/20 via-orange-500/10 to-transparent backdrop-blur-md border border-amber-500/20 p-6">
            <h3 class="text-lg font-bold text-white mb-2">Enjoyed this article?</h3>
            <p class="text-slate-400 text-sm mb-4">Subscribe to get more articles like this delivered to your inbox.</p>
            <div class="space-y-3">
              <input type="email" placeholder="Your email" class="w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50">
              <button class="w-full px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-medium rounded-lg hover:shadow-lg hover:shadow-amber-500/25 transition-all">
                Subscribe
              </button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </section>
</div>
